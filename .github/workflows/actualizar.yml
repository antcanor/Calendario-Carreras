name: Actualizar Carreras Diariamente

# Se ejecuta cada d√≠a a las 06:00 AM UTC
on:
  schedule:
    - cron: '0 6 * * *'
  # Tambi√©n permite ejecutarlo manualmente desde la web de GitHub
  workflow_dispatch:
  
jobs:
  build:
    runs-on: ubuntu-latest
    
    # Permisos para que el robot pueda guardar los cambios en el repo
    permissions:
      contents: write

    steps:
      - name: Descargar c√≥digo del repositorio
        uses: actions/checkout@v4

      - name: Instalar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Instalar librer√≠as
        run: |
          pip install -r requirements.txt
          pip install thefuzz  # Por si acaso no est√° en requirements

      - name: 1. Ejecutar Scrapers y Fusi√≥n
        run: python main.py
        # Esto ejecutar√° tus scripts y actualizar√° 'carreras.db'

      - name: 2. Publicar en Instagram
        env:
          # Izquierda: Nombre que busca Python (os.getenv)
          # Derecha: El secreto guardado en GitHub
          WEBHOOK_URL: ${{ secrets.WEBHOOK_URL }}
        run: python instagram.py

      - name: Guardar cambios (Commit & Push)
        run: |
          git config --global user.name 'Actualizador Automatico'
          git config --global user.email 'bot@noreply.github.com'
          git add carreras.db
          # Solo hacemos commit si ha cambiado algo
          git diff --quiet && git diff --staged --quiet || (git commit -m "ü§ñ Actualizaci√≥n autom√°tica de carreras" && git push)
